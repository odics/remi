<!DOCTYPE html>
<html>

<head>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <title>{% block title %}Home{% endblock %}</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <div class="d-flex">
                <a class="navbar-brand" href="#">ReMI</a>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                        {% if user.is_authenticated %}
                        <li class="nav-item">
                            <a class="btn btn-link px-3 me-2" id="home" href="/"><i class="fa-solid fa-house-user"></i>
                                Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-link px-3 me-2" id="add_recipe" href="/add_recipe"><i
                                    class="fa-solid fa-pen-to-square"></i> Add Recipe</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-link px-3 me-2" id="logout" href="/logout"><i
                                    class="fa-solid fa-right-from-bracket"></i> Log Out</a>
                        </li>
                        {% else %}
                        <li class="nav-item active">
                            <a class="nav-link" id="login" href="/login">Login<span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="signUp" href="/sign-up">Sign Up</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="home" href="/">Home</a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            <div class="navbar-nav flex-row d-none d-md-flex">
                <form class="input-group w-auto my-auto d-none d-sm-flex">
                    <input autocomplete="off" type="search" class="form-control rounded" placeholder="Search Recipes"
                        style="min-width: 125px;" />
                    <button class="btn btn-link"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
                </form>
            </div>
            <div class="d-flex align-items-center">
                <a href="/cart" class="btn btn-primary position-relative">
                    <i class="fa-sharp fa-solid fa-cart-shopping fa-xl"></i>
                    {% if shopping_list %}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill badge-danger">
                        {{ shopping_list }}
                        <span class="visually-hidden">unread messages</span>
                    </span>
                    {% endif %}
                </a>
            </div>
        </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    {% if category == 'error' %}
    <div class="alert alert-danger alert-dismissable fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% else %}
    <div class="alert alert-warning alert-dismissible" role="alert" data-mdb-color="success">
        {{ message }}
        <button type="button" class="btn-close" data-mdb-dismiss="alert"></button>
    </div>
    {% endif %}
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.js"></script>

    <script>
        $('#delete_recipe').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var title = button.data('recipe-title') // Extract info from data-* attributes
            var recipe = button.data('recipe-uuid')
            var modal = $(this)

            var new_html = '<button type="button" class="btn btn-secondary btn-sm" data-mdb-dismiss="modal">Close</button><button class="btn btn-danger btn-sm" onclick="delete_recipe(\'' + recipe + '\')\"><i class="fa fa-trash"></i> Delete Recipe</button>'

            modal.find('.modal-title').text('Delete ' + title + '?')
            modal.find('.modal-footer').html(new_html)
        })
    </script>

    <script>
        $('#delete_recipe_go_home').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var title = button.data('recipe-title') // Extract info from data-* attributes
            var recipe = button.data('recipe-uuid')
            var modal = $(this)

            var new_html = '<button type="button" class="btn btn-secondary btn-sm" data-mdb-dismiss="modal">Close</button><button class="btn btn-danger btn-sm" onclick="delete_recipe_go_home(\'' + recipe + '\')\"><i class="fa fa-trash"></i> Delete Recipe</button>'

            modal.find('.modal-title').text('Delete ' + title + '?')
            modal.find('.modal-footer').html(new_html)
        })
    </script>

    <script>
        function delete_recipe(recipe_id) {
            fetch('/delete_recipe', {
                method: 'POST',
                body: JSON.stringify({ recipe_id: recipe_id })
            }).then((_res) => {
                var currentScrollPosition = $(window).scrollTop();
                location.reload();
                setTimeout(function () {
                    $(window).scrollTop(currentScrollPosition);
                }, 100);
            });
        }
    </script>

    <script>
        function delete_recipe_go_home(recipe_id) {
            fetch('/delete_recipe_go_home', {
                method: 'POST',
                body: JSON.stringify({ recipe_id: recipe_id })
            }).then((_res) => {
                window.location.href = "/";
            });
        }
    </script>

    <script>
        function clear_cart(user_id) {
            fetch('/clear_cart', {
                method: 'POST',
                body: JSON.stringify({ user_id: user_id })
            }).then((_res) => {
                window.location.href = "/cart";
            });
        }
    </script>

    <script>
        function delete_shopping_item(item_id) {
            fetch('/delete_item', {
                method: 'POST',
                body: JSON.stringify({ item_id: item_id })
            }).then((_res) => {
                window.location.href = "/cart";
            });
        }
    </script>

    <script>
        function add_favorite(recipe_id) {
            fetch('/add_favorite', {
                method: 'POST',
                body: JSON.stringify({ recipe_id: recipe_id })
            }).then((_res) => {
                var currentScrollPosition = $(window).scrollTop();
                location.reload();
                setTimeout(function () {
                    $(window).scrollTop(currentScrollPosition);
                }, 100);
            });
        }
    </script>

    <script>
        function remove_favorite(recipe_id) {
            fetch('/remove_favorite', {
                method: 'POST',
                body: JSON.stringify({ recipe_id: recipe_id })
            }).then((_res) => {
                var currentScrollPosition = $(window).scrollTop();
                location.reload();
                setTimeout(function () {
                    $(window).scrollTop(currentScrollPosition);
                }, 100);
            });
        }
    </script>

    <script>
        function delete_tag(tag_id, view_id, recipe_id) {
            var recipe_url = "view_recipe?recipe_uuid=" + view_id
            fetch('/delete_tag', {
                method: 'POST',
                body: JSON.stringify({ tag_id: tag_id, recipe_id: recipe_id })
            }).then((_res) => {
                window.location.href = recipe_url;
            });
        }
    </script>

    <script>
        function copyShopping(list_to_copy) {
            var copyText = $(list_to_copy).data();

            navigator.clipboard.writeText(copyText.copy);
        }
    </script>

    <script>
        $(document).ready(function () {
            $('.recipe-tags').select2({
                theme: 'bootstrap-5',
                placeholder: "Tag your recipe here..."
            });
        });
    </script>

</body>

</html>